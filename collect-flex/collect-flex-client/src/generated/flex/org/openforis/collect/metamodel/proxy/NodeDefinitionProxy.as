/**
 * Generated by Gas3 v2.2.0 (Granite Data Services).
 *
 * NOTE: this file is only generated if it does not exist. You may safely put
 * your custom code here.
 */

package org.openforis.collect.metamodel.proxy {
	import org.openforis.collect.util.CollectionUtil;
	import org.openforis.collect.util.UIUtil;
	
	/**
	 * @author M. Togna
	 * @author S. Ricci
	 */
    [Bindable]
    [RemoteClass(alias="org.openforis.collect.metamodel.proxy.NodeDefinitionProxy")]
    public class NodeDefinitionProxy extends NodeDefinitionProxyBase {
		
		private var _survey:SurveyProxy;
		
		public function getLabelText(language:String = null, firstIfNotFound:Boolean = true):String {
			var labelTypes:Array = [NodeLabelProxy$Type.INSTANCE, NodeLabelProxy$Type.HEADING, null];
			var label:NodeLabelProxy = null;
			for each (var type:NodeLabelProxy$Type in labelTypes) {
				label = getLabel(type, language, false);
				if(label != null) {
					break;
				}
			}
			if(label == null && firstIfNotFound) {
				label = getLabel(null, language, true);
			}
			if(label != null) {
				return label.text;
			} else {
				return name;
			}
		}
		
		public function getLabel(type:NodeLabelProxy$Type = null, language:String = null, firstIfNotFound:Boolean = false):NodeLabelProxy {
			if(CollectionUtil.isNotEmpty(labels)) {
				for each(var label:NodeLabelProxy in labels) {
					if(label.type == type && (language == null || label.language == language)) {
						return label;
					}
				}
				if(firstIfNotFound) {
					return (labels.getItemAt(0) as NodeLabelProxy);
				}
			}
			return null;
		}
		
		public function getDescription(language:String = null):String {
			var result:String = LanguageSpecificTextProxy.getLocalizedText(descriptions, language);
			return result;
		}
		
		public function get rootEntity():EntityDefinitionProxy {
			var parentEntity:EntityDefinitionProxy = this.parent;
			if ( parentEntity == null ) {
				return this as EntityDefinitionProxy;
			}
			while ( parentEntity.parent != null ) {
				parentEntity = parentEntity.parent;
			}
			return parentEntity;
		}
		
		[Bindable]
		public function get parentLayout():String {
			if(parent != null) {
				return parent.layout;
			} else {
				return UIUtil.LAYOUT_FORM;
			}
		}
		
		public function get survey():SurveyProxy {
			return _survey;
		}
		
		public function set survey(value:SurveyProxy):void {
			_survey = value;
		}
    }
}